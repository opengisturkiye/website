<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PostGIS Raster Ä°Ã§eri Aktarma Rehberi</title>
    <meta name="description" content="PostGIS'e raster veri yÃ¼klemek iÃ§in raster2pgsql, Python ve QGIS tabanlÄ± Ã¼Ã§ yaklaÅŸÄ±mÄ± karÅŸÄ±laÅŸtÄ±rmalÄ± olarak inceleyin.">
    <link rel="icon" type="image/png" sizes="64x64" href="../../favicon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../../favicon.png">
    <link rel="apple-touch-icon" sizes="180x180" href="../../favicon.png">
    <meta name="theme-color" content="#2d6a4f">
    <link rel="stylesheet" href="../../assets/css/variables.css?v=1.1">
    <link rel="stylesheet" href="../../assets/css/header.css?v=1.1">
    <link rel="stylesheet" href="../../assets/css/footer.css?v=1.1">
    <link rel="stylesheet" href="../../assets/css/responsive.css?v=1.1">
    <link rel="stylesheet" href="../../assets/css/icons.css?v=1.1">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header class="site-header">
        <nav>
            <a href="../../index.html" class="logo">
                <img src="../../assets/images/ogt.png" alt="OpenGIS TÃ¼rkiye">
                <span class="logo-text">OpenGIS<span class="logo-sub"> TÃ¼rkiye</span></span>
            </a>
            <ul>
                <li><a href="../../index.html#topluluk">Topluluk</a></li>
                <li><a href="../../index.html#egitim">EÄŸitim</a></li>
                <li><a href="../../index.html#kaynaklar">Kaynaklar</a></li>
                <li><a href="../../index.html#etkinlikler">Etkinlikler</a></li>
                <li><a href="../../index.html#projeler">Projeler</a></li>
                <li><a href="../../harita-galerisi.html">Harita Galerisi</a></li>
                <li><a href="../../blog.html" class="active">Blog</a></li>
                <li><a href="../../index.html#destek">Destek</a></li>
            </ul>
        </nav>
    </header>

    <main class="post-container">
        <div class="post-grid">
            <article class="post-article">
                <header class="hero-section">
                    <div class="hero-overlay"></div>
                    <div class="hero-content">
                        <span class="post-category">PostGIS</span>
                        <h1>PostGIS Raster Ä°Ã§eri Aktarma Rehberi: 3 YÃ¶ntem (CLI/Python/QGIS)</h1>
                        <p class="post-lead">Raster verileri PostGIS'e almanÄ±n Ã¼Ã§ farklÄ± yolunu (raster2pgsql, Python ve QGIS) karÅŸÄ±laÅŸtÄ±rÄ±yor; hÄ±z, otomasyon ve kullanÄ±cÄ± dostu arayÃ¼z arasÄ±nda nasÄ±l seÃ§im yapacaÄŸÄ±nÄ±zÄ± gÃ¶steriyoruz.</p>
                    </div>
                </header>

                <div class="post-content">
                    <section class="post-section">
                        <h2>RasterÄ± neden PostGIS'e alÄ±yoruz?</h2>
                        <ul>
                            <li><strong>Sunucu taraflÄ± analiz</strong> (ST_SummaryStats, reclass, kesiÅŸimler)</li>
                            <li><strong>Harita servislerine tek kaynaktan veri</strong></li>
                            <li><strong>Veri yÃ¶netimi, yedekleme, eriÅŸim denetimi</strong></li>
                        </ul>
                    </section>

                    <section class="post-section">
                        <h2>Hangi yolu seÃ§meli?</h2>
                        <ul>
                            <li><strong>En hÄ±zlÄ±/standart:</strong> raster2pgsql (CLI)</li>
                            <li><strong>En esnek/otomasyona uygun:</strong> Python (rasterio + psycopg)</li>
                            <li><strong>GUI ile pratik:</strong> QGIS</li>
                        </ul>
                        <p class="dataset-callout"><strong>Ã–rnek Veri:</strong> <code>alos4326.tif</code> Â· <strong>Hedef database / tablo:</strong> <code>gisdb / public.alos</code> (kendi yolunu/tablonu deÄŸiÅŸtir)</p>
                    </section>

                    <section class="post-section">
                        <h2>YÃ¶ntem 1 â€” raster2pgsql (CLI)</h2>
                        
                        <h3>Ne yapar?</h3>
                        <p>Veriyi pipe ile doÄŸrudan psql'nin standart girdisine yÃ¶nlendiriyoruz. psql, standart girdiden (STDIN) komut alabilir.</p>
                        <p>GeoTIFF (ve diÄŸer GDAL formatlarÄ±) â†’ SQL Ã¼retir â†’ PostGIS'e dÃ¶ÅŸemeli (tile) raster tablosu olarak yazar; indeks/kÄ±sÄ±t/overview oluÅŸturabilir.</p>

                        <h3>Ã–rnek (Windows)</h3>
                        <div class="code-block">
<pre><code>raster2pgsql -s 4326 -I -C -M -t 256x256 -l 2,4,8 "C:\Users\Desktop\gisData\alos4326.tif" public.alos | psql -h localhost -p 5432 -U postgres -d gisdb</code></pre>
                        </div>

                        <h3>Ã–rnek (Linux/macOS)</h3>
                        <div class="code-block">
<pre><code>raster2pgsql -s 4326 -I -C -M -t 256x256 -l 2,4,8 "/home/gisData/alos4326.tif" public.alos | psql -h localhost -p 5432 -U postgres -d gisdb</code></pre>
                        </div>

                        <h3>Komut Parametreleri</h3>
                        <ul class="param-list">
                            <li><code>-s</code> â€” SRID ata/denetle : Ã‡Ä±kÄ±ÅŸ rasterÄ±na SRID atar. Kaynakta SRID varsa Ã§oÄŸu kez algÄ±lanÄ±r; yine de yanÄ±lma riskine karÅŸÄ± aÃ§Ä±kÃ§a verilebilir.</li>
                            <li><code>-t</code> â€” Tile : RasterÄ± parÃ§alara (tile) bÃ¶ler; satÄ±r baÅŸÄ±na bir karolu raster kaydÄ± Ã¼retilir. WIDTHxHEIGHT biÃ§imindedir; BÃ¼yÃ¼k veride okuma/Ã§izim performansÄ±nÄ± ciddi artÄ±rÄ±r. 128â€“256 px yaygÄ±n tercihlerdir. Ã‡ok bÃ¼yÃ¼k karolarda okuma maliyeti artar; aÅŸÄ±rÄ± kÃ¼Ã§Ã¼kte satÄ±r sayÄ±sÄ± ÅŸiÅŸer.</li>
                            <li><code>-I</code> â€” GiST mekÃ¢nsal indeks: Raster sÃ¼tunu iÃ§in GiST indeks oluÅŸturur (uygulamada ST_ConvexHull(rast) temellidir); mekÃ¢nsal sorgularda hÄ±z kazandÄ±rÄ±r.</li>
                            <li><code>-C</code> â€” Constraints / KÄ±sÄ±tlar : Tabloya CHECK kÄ±sÄ±tlarÄ± yazar (SRID, piksel boyutu, blocksize, bant tipi vb.) ve raster_columns/raster_overviews kataloglarÄ±nda dÃ¼zgÃ¼n gÃ¶rÃ¼nmesini saÄŸlar.</li>
                            <li><code>-M</code> â€” YÃ¼kleme sonrasÄ± VACUUM ANALYZE : YÃ¼kleme bitince tabloya VACUUM ANALYZE Ã§alÄ±ÅŸtÄ±rÄ±r; sorgu planlayÄ±cÄ±sÄ± iÃ§in istatistik Ã¼retir. BÃ¼yÃ¼k yÃ¼klemeler sonrasÄ± performansa doÄŸrudan katkÄ± saÄŸlar.</li>
                            <li><code>-l 2,4,8</code> â€” Overview tablolarÄ± : 2Ã—, 4Ã—, 8Ã— Ã¶lÃ§ekli overview'ler Ã¼retir; dÃ¼ÅŸÃ¼k zoom'larda gÃ¶rÃ¼ntÃ¼lemeyi hÄ±zlandÄ±rÄ±r. Sonradan da ST_CreateOverview ile Ã¼retilebilir; raster_overviews kataloÄŸuna kaydedilir.</li>
                        </ul>
                    </section>

                    <section class="post-section">
                        <h2>YÃ¶ntem 2 â€” Python</h2>
                        <p><strong>Gerekli kÃ¼tÃ¼phaneler:</strong> rasterio, psycopg (opsiyonel: python-dotenv)</p>

                        <h3>Ne yapar?</h3>
                        <p>GeoTIFF'i bayt olarak oku â†’ ST_FromGDALRaster(bytea) ile PostGIS tarafÄ±nda raster'a Ã§evir â†’ SRID/indeks/kÄ±sÄ±tlarÄ± uygula. (Tek tablo / tek sÃ¼tun rast)</p>

                        <h3>AkÄ±ÅŸ</h3>
                        <ol>
                            <li>GeoTIFF'i aÃ§</li>
                            <li>Metadata/SRID al</li>
                            <li>Band verisini (aslÄ±nda tÃ¼m TIFF baytlarÄ±nÄ±) oku</li>
                            <li>Uygun biÃ§ime getir (bytea)</li>
                            <li>PostGIS'e yaz (INSERT ... ST_FromGDALRaster(%s))</li>
                            <li>Ä°ndeks/kÄ±sÄ±t ekle (GiST, AddRasterConstraints)</li>
                        </ol>

                        <h3>ParÃ§a 1 â€” KÃ¼tÃ¼phaneler ve yapÄ±landÄ±rma</h3>
                        <p><em>Ne yapÄ±yoruz?</em> Ortam deÄŸiÅŸkenlerinden baÄŸlantÄ± alÄ±yoruz; dosya yolunu/tablolarÄ± tek yerden yÃ¶netiyoruz.</p>
                        <div class="code-block">
<pre><code>import os, psycopg, rasterio
from dotenv import load_dotenv
load_dotenv()

# (kendi veritabanÄ±na uyarla)
PG_HOST=os.getenv("PGHOST","localhost"); PG_PORT=os.getenv("PGPORT","5432")
PG_DB=os.getenv("PGDATABASE","gisdb");   PG_USER=os.getenv("PGUSER","postgres")
PG_PASS=os.getenv("PGPASSWORD");         PG_SCHEMA=os.getenv("PGSCHEMA","public")

SRC_PATH=r"C:\Users\Desktop\gisData\alos4326.tif"  # (kendi yolunu ver)
TABLE="alos_simple"; RAST_COL="rast"</code></pre>
                        </div>

                        <h3>ParÃ§a 2 â€” GeoTIFF'i oku, SRID'i tespit et</h3>
                        <p><em>Ne yapÄ±yoruz?</em> DosyayÄ± bayt olarak alÄ±yoruz; rasterio ile CRSâ†’EPSG Ã§Ã¶zÃ¼yoruz. Neden? ST_FromGDALRaster bytea ister; SRID set'i gerekebilir.</p>
                        <div class="code-block">
<pre><code>with open(SRC_PATH, "rb") as f:
    tif_bytes = f.read()
with rasterio.open(SRC_PATH) as src:
    srid = src.crs.to_epsg() if src.crs else None</code></pre>
                        </div>

                        <h3>ParÃ§a 3 â€” BaÄŸlantÄ± ve raster tipi kontrolÃ¼</h3>
                        <p><em>Ne yapÄ±yoruz?</em> postgis_raster etkin mi bakÄ±yoruz. Neden? Erken ve anlamlÄ± hata iÃ§in.</p>
                        <div class="code-block">
<pre><code>conn_str=f"host={PG_HOST} port={PG_PORT} dbname={PG_DB} user={PG_USER} password={PG_PASS}"
with psycopg.connect(conn_str) as conn:
    has_raster = conn.execute(
        "SELECT EXISTS (SELECT 1 FROM pg_type WHERE typname='raster');"
    ).fetchone()[0]
    if not has_raster:
        raise RuntimeError("postgis_raster etkin deÄŸil.")

    conn.execute(f"SET search_path TO {PG_SCHEMA}, public, pg_catalog;")</code></pre>
                        </div>

                        <h3>ParÃ§a 4 â€” Tabloyu oluÅŸtur ve veriyi yaz</h3>
                        <p><em>Ne yapÄ±yoruz?</em> Raster sÃ¼tunu olan tabloyu aÃ§Ä±yoruz; bytea â†’ raster dÃ¶nÃ¼ÅŸÃ¼mÃ¼nÃ¼ DB'de yapÄ±yoruz.</p>
                        <div class="code-block">
<pre><code>conn.execute(f"""
        CREATE TABLE IF NOT EXISTS {PG_SCHEMA}.{TABLE}(
            id bigserial PRIMARY KEY,
            {RAST_COL} raster
        );
    """)
    conn.execute(
        f"INSERT INTO {PG_SCHEMA}.{TABLE}({RAST_COL}) VALUES (ST_FromGDALRaster(%s));",
        (psycopg.Binary(tif_bytes),)
    )</code></pre>
                        </div>

                        <h3>ParÃ§a 5 â€” SRID ayarla (varsa)</h3>
                        <p><em>Ne yapÄ±yoruz?</em> CRS varsa ST_SetSRID ile uyguluyoruz.</p>
                        <div class="code-block">
<pre><code>if srid:
        conn.execute(
            f"UPDATE {PG_SCHEMA}.{TABLE} SET {RAST_COL}=ST_SetSRID({RAST_COL}, %s) "
            f"WHERE ST_SRID({RAST_COL}) IS DISTINCT FROM %s;",
            (srid, srid)
        )</code></pre>
                        </div>

                        <h3>ParÃ§a 6 â€” KÄ±sÄ±tlar + indeks</h3>
                        <p><em>Ne yapÄ±yoruz?</em> AddRasterConstraints (varsa) ve GiST indeks oluÅŸturuyoruz. Neden? raster_columns gÃ¶rÃ¼nÃ¼rlÃ¼ÄŸÃ¼ ve sorgu performansÄ±.</p>
                        <div class="code-block">
<pre><code>conn.execute("SAVEPOINT s_addrc;")
    try:
        conn.execute("SELECT AddRasterConstraints(%s,%s,%s);", (PG_SCHEMA, TABLE, RAST_COL))
    except Exception:
        conn.execute("ROLLBACK TO SAVEPOINT s_addrc;")

    conn.execute(
        f"CREATE INDEX IF NOT EXISTS {TABLE}_rast_gist "
        f"ON {PG_SCHEMA}.{TABLE} USING GIST (ST_ConvexHull({RAST_COL}));"
    )
    conn.commit()</code></pre>
                        </div>
                    </section>

                    <section class="post-section">
                        <h2>YÃ¶ntem 3 â€” QGIS ArayÃ¼zÃ¼</h2>
                        
                        <h3>Eklentiyi kur</h3>
                        <p>Plugins â†’ Manage and Install Pluginsâ€¦ â†’ "PostGIS Raster Import" ara â†’ Install.</p>
                        <img src="img/1761550999937.png" alt="PostGIS Raster Import Eklentisi" class="post-image">

                        <h3>BaÄŸlantÄ±yÄ± seÃ§</h3>
                        <p>Database â†’ PostGIS Raster Import â†’ "Database connection" alanÄ±ndan daha Ã¶nce kaydettiÄŸin PostGIS baÄŸlantÄ±sÄ±nÄ± seÃ§. (Yoksa QGIS Browser'da PostgreSQL altÄ±nda yeni baÄŸlantÄ± ekle.)</p>
                        <img src="img/1761550999600.png" alt="QGIS Database BaÄŸlantÄ±sÄ±" class="post-image">

                        <h3>YÃ¼klemeyi tamamla</h3>
                        <p>"Raster layer" menÃ¼sÃ¼nden dosyanÄ± seÃ§ip hedef ÅŸema ve tablo adÄ±nÄ± belirleyerek yÃ¼klemeyi tamamla.</p>
                    </section>

                    <section class="post-section">
                        <h2>Ã–zet</h2>
                        <p>Bu yazÄ±daki Ã¼Ã§ yaklaÅŸÄ±mÄ±n her biri farklÄ± ihtiyaÃ§lara hitap ediyor:</p>
                        <ul>
                            <li><strong>HÄ±z ve standart Ã¼retim hattÄ±:</strong> raster2pgsql (CLI)</li>
                            <li><strong>Esneklik ve otomasyon:</strong> Python</li>
                            <li><strong>GUI ile pratik kullanÄ±m:</strong> QGIS eklentisi</li>
                        </ul>
                        <p>Bir sonraki yazÄ±da, PostGIS Ã¼zerinde bu rasterlar ile yapÄ±labilecek iÅŸlemlere deÄŸinip, performans ipuÃ§larÄ±, tiling/overview stratejileri ve senaryolarÄ±nÄ± da ele alacaÄŸÄ±z.</p>
                    </section>
                </div>

                <footer class="post-footer">
                    <div class="footer-meta">
                        <p class="footer-author"><strong>Yazar:</strong> OpenGIS TÃ¼rkiye TopluluÄŸu</p>
                        <p class="footer-date"><strong>GÃ¼ncelleme Tarihi:</strong> Ekim 2025</p>
                    </div>
                    <h2 id="kaynaklar">Ek Kaynaklar</h2>
                    <ul>
                        <li><a href="https://postgis.net/docs/using_raster_dataman.html" target="_blank" rel="noopener">PostGIS raster2pgsql dÃ¶kÃ¼mantasyonu</a></li>
                        <li><a href="https://rasterio.readthedocs.io/" target="_blank" rel="noopener">rasterio belgeleri</a></li>
                        <li><a href="https://docs.qgis.org/latest/tr/docs/user_manual/" target="_blank" rel="noopener">QGIS KullanÄ±cÄ± KÄ±lavuzu</a></li>
                    </ul>
                </footer>
            </article>

            
        </div>
    </main>

    <footer>
        <div class="footer-content">
            <div class="footer-section">
                <h3>AÃ§Ä±k Kaynak CBS TopluluÄŸu</h3>
                <p>TÃ¼rkiye'nin en bÃ¼yÃ¼k aÃ§Ä±k kaynak CBS kullanÄ±cÄ±larÄ± topluluÄŸu. QGIS, PostGIS, GeoServer ve diÄŸer aÃ§Ä±k kaynak teknolojileri Ã¶ÄŸrenin ve paylaÅŸÄ±n.</p>
                <p>Bu topluluk tamamen gÃ¶nÃ¼llÃ¼ katkÄ±larla yÃ¼rÃ¼tÃ¼lmektedir.</p>
                <div class="contact-info">
                    <a href="mailto:opengisturkiye@gmail.com">ğŸ“§ opengisturkiye@gmail.com</a>
                </div>
            </div>

            <div class="footer-section">
                <h3>HÄ±zlÄ± BaÄŸlantÄ±lar</h3>
                <ul>
                    <li><a href="../../index.html#topluluk">Topluluk</a></li>
                    <li><a href="../../index.html#egitim">EÄŸitim</a></li>
                    <li><a href="../../index.html#kaynaklar">Kaynaklar</a></li>
                    <li><a href="../../index.html#etkinlikler">Etkinlikler</a></li>
                    <li><a href="../../index.html#projeler">Projeler</a></li>
                    <li><a href="../../blog.html">Blog</a></li>
                </ul>
            </div>

            <div class="footer-section">
                <h3>Kaynaklar</h3>
                <ul>
                    <li><a href="https://qgis.org" target="_blank">QGIS.org</a></li>
                    <li><a href="https://postgis.net" target="_blank">PostGIS.net</a></li>
                    <li><a href="https://geoserver.org" target="_blank">GeoServer.org</a></li>
                    <li><a href="https://osgeo.org" target="_blank">OSGeo.org</a></li>
                </ul>
            </div>

            <div class="footer-section">
                <h3>Sosyal Medya &amp; Ä°letiÅŸim</h3>
                <div class="social-links">
                    <a href="https://www.youtube.com/@OpenGISTurkiye" target="_blank" class="social-link youtube">YouTube</a>
                    <a href="https://github.com/OpenGISTurkiye" target="_blank" class="social-link github">GitHub</a>
                    <a href="http://linkedin.com/company/OpenGISTurkiye" target="_blank" class="social-link linkedin">LinkedIn</a>
                    <a href="https://x.com/OpenGISTurkiye" target="_blank" class="social-link twitter">X (Twitter)</a>
                    <a href="https://discord.gg/yZvbDSeH" target="_blank" class="social-link discord">Discord</a>
                    <a href="https://chat.whatsapp.com/ERw4FtkT1jg6gUvlUdgbNY?mode=ems_copy_t" target="_blank" class="social-link whatsapp">WhatsApp</a>
                </div>
            </div>
        </div>

        <div class="footer-bottom">
            <p>&copy; 2025 AÃ§Ä±k Kaynak CBS KullanÄ±cÄ±larÄ± TopluluÄŸu. Bu proje Creative Commons lisansÄ± altÄ±ndadÄ±r.</p>
        </div>
    </footer>
</body>
</html>
